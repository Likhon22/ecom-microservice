_format_version: "3.0"
_transform: true
services:
  - name: auth-service
    url: grpc://host.docker.internal:5002
    routes:
      - name: create-user-route
        paths: [/users]
        methods: [POST]
        plugins:
          - name: auth-token-validator
            config:
              jwt_secret: "very very secret access token"

      - name: login-route
        paths: [/auth/login]
        methods: [POST]
        plugins:
          - name: grpc-cookie-transformer

      - name: validation-route
        paths: [/auth/refresh/validate]
        methods: [POST]
        plugins:
          - name: auth-metadata-setter
          - name: grpc-cookie-transformer
      
      - name: logout-route
        paths: [/auth/logout]
        methods: [POST]
        plugins:
          - name: auth-metadata-setter
          - name: auth-cookie-clearer 

    plugins: # Service-level plugins (apply to ALL routes)
      - name: grpc-gateway
        config:
          proto: "/kong/protos/auth.proto"

  - name: user-service
    url: grpc://host.docker.internal:5001
    routes:
      - name: get-all-user-routes
        paths: [/customers]
        methods: [GET]
    plugins:
      - name: grpc-gateway
        config:
          proto: /kong/protos/user.proto

